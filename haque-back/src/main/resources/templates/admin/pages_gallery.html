<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="keywords" content="Haque后台管理系统">
  <meta name="description" content="Haque后台管理系统">
  <meta name="author" content="yinq">
  <title>图库列表</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" type="text/css" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" th:href="@{/css/style.min.css}">
</head>

<body>

<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <aside class="lyear-layout-sidebar" th:replace="admin/admin_page::sidebar"></aside>
    <!--End 左侧导航-->

    <!--头部信息-->
    <header class="lyear-layout-header" th:replace="admin/admin_page::header"></header>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">

      <div class="form-group col-md-12">

        <form method="post" enctype="multipart/form-data" th:action="@{/admin/upload_img}">
          <a class="btn btn-primary m-r-5" id="add-pic-btn" href="#!" title="点击上传" οnclick="addImage()">上传</a>
          <input type="file" id="file" name="file" style="display:none;" onchange="upload()">
        </form>
        <div class="form-controls">
          <ul id="img_gallery" class="list-inline row lyear-uploads-pic mb-0" th:each="image:${images}">
            <li class="col-6 col-md-4 col-lg-2">
              <figure>
                <img th:src="@{|/images/gallery/${image.imgUrl}|}" alt="图片一">
                <figcaption>
                  <a class="btn btn-round btn-square btn-primary" th:href="@{|/images/gallery/${image.imgUrl}|}"><i class="mdi mdi-eye"></i></a>
                  <a class="btn btn-round btn-square btn-danger" th:href="@{|/admin/delete_img/${image.imgUrl}|}"><i class="mdi mdi-delete"></i></a>
                </figcaption>
              </figure>
            </li>
          </ul>
        </div>
      </div>


    </main>



    <!--End 页面主要内容-->
  </div>
</div>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" th:src="@{/js/popper.min.js}"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.perfect-scrollbar/1.5.0/perfect-scrollbar.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type="text/javascript" th:src="@{/js/main.min.js}"></script>

<script>
  $("#add-pic-btn").click(function(){
    document.getElementById("file").click();
  });
</script>

<script>
  function upload() {
    const CONTEXT_PATH = "/haque/admin";
    const formData = new FormData();
    formData.append('file', document.getElementById('file').files[0]);
    $.ajax({
        url: CONTEXT_PATH + "/upload_img",
        data: formData,
        type: "Post",
        dataType: "json",
        cache: false,//上传文件无需缓存
        processData: false,//用于对data参数进行序列化处理 这里必须false
        contentType: false, //必须
        success: function (result) {
          if (result.code == 0) {
            alert("上传成功")
            window.location.reload();
          } else {
            alert(result.msg)
          }
        }, error: function (ex) {
          console.warn(ex)
        }
    })


  }
</script>

</body>
</html>